<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.calvin.dao.SosDao">
    <resultMap id="sosResult" type="Sos">
        <id column="sid" property="sid" javaType="Integer"/>
        <result column="uid" property="uid" javaType="Integer"/>
        <result column="message" property="message" javaType="Integer"/>
        <result column="longitude" property="longitude" javaType="Double"/>
        <result column="latitude" property="latitude" javaType="Double"/>
        <result column="post_time" property="postTime" javaType="Date"/>

        <association property="user" javaType="User">
            <id column="uid" property="uid" javaType="Integer"/>
            <result column="username" property="username" javaType="String"/>
            <result column="password" property="password" javaType="String"/>
        </association>
    </resultMap>

    <insert id="insert" parameterType="Sos" useGeneratedKeys="true" keyProperty="sid">
        insert into sos(uid,message,longitude,latitude,postTime)
        values (#{uid} ,#{message} ,#{longitude} ,#{latitude} ,#{postTime,jdbcType=TIMESTAMP} )
    </insert>

    <select id="select" resultMap="sosResult" parameterType="integer">
       select u.uid,u.username,s.sid,s.message,s.longitude,s.latitude,s.postTime  from user u inner join sos s
       where u.uid=s.uid and u.uid=#{uid}
    </select>

    <select id="selectAll" resultMap="sosResult">
        select * from sos order by postTime desc
    </select>
</mapper>